import{x as h,y as R,a as D,d as Q,c as $,l as q,A as J,e as j,g as G,B as K,k as W,f as X,C as Z,D as ee,F as te,G as ae,H as le}from"./element-plus-DI_bgyNY.js";import{_ as oe}from"./PageContainer-CEqipD4d.js";import{a as ne,b as se,c as re,d as ue,e as ie,f as de}from"./article-po3hsoAI.js";import{d as ce}from"./dayjs-CxMP4GVf.js";import{F as pe,G as me,r as _e}from"./@element-plus-CxMXKtfz.js";import{c as ve}from"./index-BD1jMUha.js";import{T as fe,E as ge}from"./@wangeditor-8Iuzr9Wb.js";import{a as be}from"./axios-CCb-kr4I.js";import{at as ye,r as _,o as f,R as C,Q as l,c as I,O as we,ag as Ve,s as Ce,M as e,u as V,a as Ee,U as w,_ as xe,V as F}from"./@vue-BIhkC9RN.js";import{_ as ke}from"./plugin-vue:export-helper-DlAUqK2U.js";import"./lodash-es-CxpLErxa.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-D3_Zpga0.js";import"./@ctrl-r5W6hzzQ.js";import"./@sxzz-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./pinia-_JLQ5g36.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-BQU3TZ4K.js";import"./destr-CVtkxrq9.js";import"./deep-pick-omit-CegYQlcN.js";import"./vue-router-jgiCMz-_.js";const Ue=E=>ce(E).format("YYYY年MM日DD日"),N={__name:"ChannelSelect",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(E){const g=ye(E,"modelValue"),v=_([]);return(async()=>{const i=await ne();v.value=i.data.data})(),(i,o)=>{const d=h,n=R;return f(),C(n,{modelValue:g.value,"onUpdate:modelValue":o[0]||(o[0]=r=>g.value=r),style:{width:"240px"}},{default:l(()=>[(f(!0),I(we,null,Ve(v.value,r=>(f(),C(d,{key:r.id,label:r.cate_name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])}}},Le=["src"],Se={style:{border:"1px solid #ccc"}},ze={__name:"ArticleEdit",emits:["success"],setup(E,{expose:g,emit:v}){const b=v,i=_(!1),o=_(!1),d={title:"",cate_id:"",content:"",cover_img:"",state:""},n=_({...d}),r=_(""),S=a=>{r.value=URL.createObjectURL(a.raw),n.value.cover_img=a.raw},k=Ce(),z={placeholder:"请输入内容..."},A=a=>{k.value=a},B=async a=>{if(a.id){const t=await se(a.id);n.value=t.data.data,r.value=ve+n.value.cover_img;const c=await s(r.value,n.value.cover_img,"image/jpeg");n.value.cover_img=c}else n.value={...d},r.value="";o.value=!0},U=async a=>{n.value.state=a;const t=new FormData;for(const c in n.value)t.append(c,n.value[c]);n.value.id?(i.value=!0,await re(t),D.success("编辑文章成功"),i.value=!1,o.value=!1,b("success","edit")):(i.value=!0,await ue(t),D.success("发布文章成功"),i.value=!1,o.value=!1,b("success","add"))};async function s(a,t,c){try{const x=(await be.get(a,{responseType:"blob"})).data;return new File([x],t,{type:c})}catch(p){throw console.error("Error fetching and converting image:",p),p}}return g({open:B}),(a,t)=>{const c=Q,p=$,x=q,M=J,L=j,y=G,T=K;return f(),C(T,{modelValue:o.value,"onUpdate:modelValue":t[5]||(t[5]=m=>o.value=m),title:n.value.id?"编辑文章":"添加文章",size:"50%"},{default:l(()=>[e(y,{"label-width":"100px"},{default:l(()=>[e(p,{label:"文章标题"},{default:l(()=>[e(c,{modelValue:n.value.title,"onUpdate:modelValue":t[0]||(t[0]=m=>n.value.title=m),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),e(p,{label:"文章分类"},{default:l(()=>[e(N,{modelValue:n.value.cate_id,"onUpdate:modelValue":t[1]||(t[1]=m=>n.value.cate_id=m),style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(p,{label:"文章封面"},{default:l(()=>[e(M,{class:"avatar-uploader","show-file-list":!1,"auto-upload":!1,"on-change":S},{default:l(()=>[r.value?(f(),I("img",{key:0,src:r.value,class:"avatar"},null,8,Le)):(f(),C(x,{key:1,class:"avatar-uploader-icon"},{default:l(()=>[e(V(pe))]),_:1}))]),_:1})]),_:1}),e(p,{label:"文章内容"},{default:l(()=>[Ee("div",Se,[e(V(fe),{style:{"border-bottom":"1px solid #ccc"},editor:k.value},null,8,["editor"]),e(V(ge),{modelValue:n.value.content,"onUpdate:modelValue":t[2]||(t[2]=m=>n.value.content=m),style:{height:"500px","overflow-y":"hidden"},"default-config":z,onOnCreated:A},null,8,["modelValue"])])]),_:1}),e(p,null,{default:l(()=>[e(L,{disabled:i.value,type:"primary",onClick:t[3]||(t[3]=m=>U("已发布"))},{default:l(()=>t[6]||(t[6]=[w(" 发布 ")])),_:1},8,["disabled"]),e(L,{disabled:i.value,onClick:t[4]||(t[4]=m=>U("草稿"))},{default:l(()=>t[7]||(t[7]=[w(" 草稿 ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])}}},Ae=ke(ze,[["__scopeId","data-v-77c1e32f"]]),Ze={__name:"ArticleManage",setup(E){const g=_([]),v=_(0),b=_(!1),i=_(),o=_({pagenum:1,pagesize:5,cate_id:"",state:""}),d=async()=>{b.value=!0;const s=await ie(o.value);g.value=s.data.data,v.value=s.data.total,b.value=!1};d();const n=s=>{o.value.pagenum=1,o.value.pagesize=s,d()},r=s=>{o.value.pagenum=s,d()},S=()=>{o.value.pagenum=1,d()},k=()=>{o.value.pagenum=1,o.value.cate_id="",o.value.state="",d()},z=()=>{i.value.open({})},A=s=>{i.value.open(s)},B=async s=>{await W.confirm("你确认要删除该文章吗","温馨提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await de(s.id),D.success("删除成功"),d()},U=s=>{if(s==="add"){const a=Math.ceil((v.value+1)/o.value.pagesize);o.value.pagenum=a}d()};return(s,a)=>{const t=j,c=$,p=h,x=R,M=G,L=X,y=Z,T=ee,m=te,O=ae,Y=oe,P=le;return f(),C(Y,{title:"文章管理"},{extra:l(()=>[e(t,{type:"primary",onClick:z},{default:l(()=>a[4]||(a[4]=[w(" 发布文章 ")])),_:1})]),default:l(()=>[e(M,{inline:!0},{default:l(()=>[e(c,{label:"文章分类:"},{default:l(()=>[e(N,{modelValue:o.value.cate_id,"onUpdate:modelValue":a[0]||(a[0]=u=>o.value.cate_id=u)},null,8,["modelValue"])]),_:1}),e(c,{label:"发布状态:"},{default:l(()=>[e(x,{modelValue:o.value.state,"onUpdate:modelValue":a[1]||(a[1]=u=>o.value.state=u),style:{width:"200px"}},{default:l(()=>[e(p,{label:"已发布",value:"已发布"}),e(p,{label:"草稿",value:"草稿"})]),_:1},8,["modelValue"])]),_:1}),e(c,null,{default:l(()=>[e(t,{type:"primary",onClick:S},{default:l(()=>a[5]||(a[5]=[w(" 搜索 ")])),_:1}),e(t,{onClick:k},{default:l(()=>a[6]||(a[6]=[w(" 重置 ")])),_:1})]),_:1})]),_:1}),xe((f(),C(m,{data:g.value,style:{width:"100%"}},{empty:l(()=>[e(T,{description:"NULL"})]),default:l(()=>[e(y,{prop:"title",label:"文章标题"},{default:l(({row:u})=>[e(L,{type:"primary",underline:!1},{default:l(()=>[w(F(u.title),1)]),_:2},1024)]),_:1}),e(y,{prop:"cate_name",label:"分类"}),e(y,{prop:"pub_date",label:"发表时间"},{default:l(({row:u})=>[w(F(V(Ue)(u.pub_date)),1)]),_:1}),e(y,{prop:"state",label:"状态"}),e(y,{label:"操作",width:"150"},{default:l(({row:u})=>[e(t,{icon:V(me),type:"primary",plain:"",circle:"",onClick:H=>A(u)},null,8,["icon","onClick"]),e(t,{icon:V(_e),type:"danger",plain:"",circle:"",onClick:H=>B(u)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[P,b.value]]),e(O,{"current-page":o.value.pagenum,"onUpdate:currentPage":a[2]||(a[2]=u=>o.value.pagenum=u),"page-size":o.value.pagesize,"onUpdate:pageSize":a[3]||(a[3]=u=>o.value.pagesize=u),"page-sizes":[2,3,5,10],background:!0,layout:"jumper, total, sizes, prev, pager, next",total:v.value,style:{"justify-content":"center","margin-top":"20px"},onSizeChange:n,onCurrentChange:r},null,8,["current-page","page-size","total"]),e(Ae,{ref_key:"drawer",ref:i,onSuccess:U},null,512)]),_:1})}}};export{Ze as default};
